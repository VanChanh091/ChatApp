{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"D:\\\\20045291\\\\CNM\\\\BTL\\\\realtime-chat-app-main\\\\FrontEnd\\\\screens\\\\GroupChatScreen.js\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport ScrollView from \"react-native-web/dist/exports/ScrollView\";\nimport KeyboardAvoidingView from \"react-native-web/dist/exports/KeyboardAvoidingView\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport Pressable from \"react-native-web/dist/exports/Pressable\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport React, { useState, useContext, useLayoutEffect, useEffect, useRef } from \"react\";\nimport { Feather } from \"@expo/vector-icons\";\nimport { Ionicons } from \"@expo/vector-icons\";\nimport { FontAwesome } from \"@expo/vector-icons\";\nimport { MaterialIcons } from \"@expo/vector-icons\";\nimport { Entypo } from \"@expo/vector-icons\";\nimport EmojiSelector from \"react-native-emoji-selector\";\nimport { UserType } from \"../UserContext\";\nimport { useNavigation, useRoute } from \"@react-navigation/native\";\nimport * as ImagePicker from \"expo-image-picker\";\nimport { io } from \"socket.io-client\";\nimport * as DocumentPicker from \"expo-document-picker\";\nimport { AntDesign } from '@expo/vector-icons';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function GroupChatScreen(_ref) {\n  var _this = this;\n  var route = _ref.route;\n  var groupId = route.params.groupId;\n  var _useState = useState(false),\n    _useState2 = _slicedToArray(_useState, 2),\n    showEmojiSelector = _useState2[0],\n    setShowEmojiSelector = _useState2[1];\n  var _useState3 = useState([]),\n    _useState4 = _slicedToArray(_useState3, 2),\n    selectedMessages = _useState4[0],\n    setSelectedMessages = _useState4[1];\n  var _useState5 = useState([]),\n    _useState6 = _slicedToArray(_useState5, 2),\n    messages = _useState6[0],\n    setMessages = _useState6[1];\n  var _useState7 = useState(),\n    _useState8 = _slicedToArray(_useState7, 2),\n    recepientData = _useState8[0],\n    setRecepientData = _useState8[1];\n  var navigation = useNavigation();\n  var _useState9 = useState(\"\"),\n    _useState10 = _slicedToArray(_useState9, 2),\n    selectedImage = _useState10[0],\n    setSelectedImage = _useState10[1];\n  var _useState11 = useState(),\n    _useState12 = _slicedToArray(_useState11, 2),\n    group = _useState12[0],\n    setgroup = _useState12[1];\n  var _useState13 = useState([]),\n    _useState14 = _slicedToArray(_useState13, 2),\n    memberId = _useState14[0],\n    setMemberId = _useState14[1];\n  var _useState15 = useState(\"\"),\n    _useState16 = _slicedToArray(_useState15, 2),\n    message = _useState16[0],\n    setMessage = _useState16[1];\n  var _useContext = useContext(UserType),\n    userId = _useContext.userId,\n    setUserId = _useContext.setUserId;\n  var _useState17 = useState([]),\n    _useState18 = _slicedToArray(_useState17, 2),\n    usersDetais = _useState18[0],\n    setUsersDetail = _useState18[1];\n  var scrollViewRef = useRef(null);\n  var socketRef = useRef(null);\n  useEffect(function () {\n    var fetchGroupInfo = function () {\n      var _ref2 = _asyncToGenerator(function* () {\n        try {\n          var response = yield fetch(`http://localhost:8000/group/${groupId}`);\n          var data = yield response.json();\n          if (response.ok) {\n            setgroup(data);\n            var memberIds = data.members.map(function (member) {\n              return member._id;\n            });\n            setMemberId(memberIds);\n            console.log(\"memberIds:\", memberIds);\n          } else {\n            console.log(\"error fetching group info\", response.status.message);\n          }\n        } catch (error) {\n          console.log(\"error fetching group info\", error);\n        }\n      });\n      return function fetchGroupInfo() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n    fetchGroupInfo();\n  }, []);\n  useEffect(function () {\n    var getDetailUserInGroup = function () {\n      var _ref3 = _asyncToGenerator(function* () {\n        try {\n          var response = yield fetch(\"http://localhost:8000/groups/users\", {\n            method: \"POST\",\n            headers: {\n              \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify({\n              userIds: memberId\n            })\n          });\n          if (!response.ok) {\n            throw new Error(\"Lỗi khi truy vấn người dùng\");\n          }\n          var users = yield response.json();\n          setUsersDetail(users);\n          console.log(\"danh sách nguoi dung:\", usersDetais);\n          return users;\n        } catch (error) {\n          console.error(\"Lỗi khi gửi yêu cầu:\", error);\n          return null;\n        }\n      });\n      return function getDetailUserInGroup() {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n    getDetailUserInGroup();\n  }, [memberId]);\n  useEffect(function () {\n    socketRef.current = io(\"http://localhost:8000\");\n    socketRef.current.on(\"newMessageGroup\", function (newMessage) {\n      setMessages(function (prevMessages) {\n        return [].concat(_toConsumableArray(prevMessages), [newMessage]);\n      });\n    });\n    socketRef.current.on(\"sendMessageGroup\", function (_ref4) {\n      var newMessage = _ref4.newMessage;\n      setMessages(function (prevMessages) {\n        return [].concat(_toConsumableArray(prevMessages), [newMessage]);\n      });\n    });\n    return function () {\n      socketRef.current.disconnect();\n    };\n  }, []);\n  useEffect(function () {\n    scrollToBottom();\n  }, []);\n  var scrollToBottom = function scrollToBottom() {\n    if (scrollViewRef.current) {\n      scrollViewRef.current.scrollToEnd({\n        animated: false\n      });\n    }\n  };\n  var handleContentSizeChange = function handleContentSizeChange() {\n    scrollToBottom();\n  };\n  var handleEmojiPress = function handleEmojiPress() {\n    setShowEmojiSelector(!showEmojiSelector);\n  };\n  var fetchMessages = function () {\n    var _ref5 = _asyncToGenerator(function* () {\n      try {\n        var response = yield fetch(`http://localhost:8000/group-messages/${groupId}`);\n        var data = yield response.json();\n        if (response.ok) {\n          setMessages(data);\n        } else {\n          console.log(\"error showing messags\", response.status.message);\n        }\n      } catch (error) {\n        console.log(\"error fetching messages\", error);\n      }\n    });\n    return function fetchMessages() {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n  useEffect(function () {\n    fetchMessages();\n  }, []);\n  useEffect(function () {\n    var fetchRecepientData = function () {\n      var _ref6 = _asyncToGenerator(function* () {\n        try {\n          var response = yield fetch(`http://localhost:8000/group-messages/${groupId}`);\n          var data = yield response.json();\n          setRecepientData(data);\n          console.log(\"recepient data:\", data);\n        } catch (error) {\n          console.log(\"error retrieving details\", error);\n        }\n      });\n      return function fetchRecepientData() {\n        return _ref6.apply(this, arguments);\n      };\n    }();\n    fetchRecepientData();\n  }, []);\n  var handleSend = function () {\n    var _ref7 = _asyncToGenerator(function* (messageType, imageUri) {\n      try {\n        var formData = new FormData();\n        formData.append(\"senderId\", userId);\n        formData.append(\"groupId\", groupId);\n        formData.append(\"recepientId\", memberId);\n        if (messageType === \"image\") {\n          formData.append(\"messageType\", \"image\");\n          formData.append(\"imageFile\", {\n            uri: imageUri,\n            name: \"image.jpg\",\n            type: \"image/jpeg\"\n          });\n        } else {\n          formData.append(\"messageType\", \"text\");\n          formData.append(\"messageText\", message);\n        }\n        var response = yield fetch(\"http://localhost:8000/group-messages\", {\n          method: \"POST\",\n          body: formData\n        });\n        if (response.ok) {\n          setMessage(\"\");\n          setSelectedImage(\"\");\n          socketRef.current.emit(\"sendMessage\", {\n            senderId: userId,\n            recepientId: memberId,\n            newMessage: response.newMessage\n          });\n          fetchMessages();\n        }\n      } catch (error) {\n        console.log(\"error in sending the message\", error);\n      }\n    });\n    return function handleSend(_x, _x2) {\n      return _ref7.apply(this, arguments);\n    };\n  }();\n  var handdleToDetailGroup = function handdleToDetailGroup() {\n    navigation.navigate(\"GroupInfoScreen\", {\n      groupId: groupId\n    });\n  };\n  useLayoutEffect(function () {\n    navigation.setOptions({\n      headerTitle: \"\",\n      headerLeft: function headerLeft() {\n        return _jsxDEV(View, {\n          style: {\n            flexDirection: \"row\",\n            alignItems: \"center\",\n            gap: 10,\n            marginLeft: 10\n          },\n          children: [_jsxDEV(Ionicons, {\n            onPress: function onPress() {\n              return navigation.goBack();\n            },\n            name: \"arrow-back\",\n            size: 24,\n            color: \"black\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 241,\n            columnNumber: 11\n          }, _this), selectedMessages.length > 0 ? _jsxDEV(View, {\n            children: _jsxDEV(Text, {\n              style: {\n                fontSize: 16,\n                fontWeight: \"500\"\n              },\n              children: selectedMessages.length\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 250,\n              columnNumber: 15\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 249,\n            columnNumber: 13\n          }, _this) : _jsxDEV(View, {\n            style: {\n              flexDirection: \"row\",\n              alignItems: \"center\"\n            },\n            children: _jsxDEV(Text, {\n              style: {\n                marginLeft: 10,\n                fontSize: 20,\n                fontWeight: \"bold\"\n              },\n              children: group == null ? void 0 : group.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 256,\n              columnNumber: 15\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 255,\n            columnNumber: 13\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 240,\n          columnNumber: 9\n        }, _this);\n      },\n      headerRight: function headerRight() {\n        return selectedMessages.length > 0 ? _jsxDEV(View, {\n          style: {\n            flexDirection: \"row\",\n            alignItems: \"center\",\n            gap: 10\n          },\n          children: [_jsxDEV(Ionicons, {\n            name: \"arrow-redo-sharp\",\n            size: 24,\n            color: \"black\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 266,\n            columnNumber: 13\n          }, _this), _jsxDEV(Ionicons, {\n            name: \"arrow-undo\",\n            size: 24,\n            color: \"black\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 267,\n            columnNumber: 13\n          }, _this), _jsxDEV(FontAwesome, {\n            name: \"star\",\n            size: 24,\n            color: \"black\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 268,\n            columnNumber: 13\n          }, _this), _jsxDEV(MaterialIcons, {\n            onPress: function onPress() {\n              return deleteMessages(selectedMessages);\n            },\n            name: \"delete\",\n            size: 24,\n            color: \"black\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 269,\n            columnNumber: 13\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 265,\n          columnNumber: 11\n        }, _this) : _jsxDEV(View, {\n          children: _jsxDEV(AntDesign, {\n            name: \"bars\",\n            size: 24,\n            color: \"black\",\n            onPress: handdleToDetailGroup,\n            style: {\n              marginRight: 10\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 277,\n            columnNumber: 19\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 277,\n          columnNumber: 13\n        }, _this);\n      }\n    });\n  }, [recepientData, selectedMessages]);\n  var deleteMessages = function () {\n    var _ref8 = _asyncToGenerator(function* (messageIds) {\n      try {\n        var response = yield fetch(\"http://localhost:8000/deleteMessages\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          body: JSON.stringify({\n            messages: messageIds\n          })\n        });\n        if (response.ok) {\n          setSelectedMessages(function (prevSelectedMessages) {\n            return prevSelectedMessages.filter(function (id) {\n              return !messageIds.includes(id);\n            });\n          });\n          fetchMessages();\n        } else {\n          console.log(\"error deleting messages\", response.status);\n        }\n      } catch (error) {\n        console.log(\"error deleting messages\", error);\n      }\n    });\n    return function deleteMessages(_x3) {\n      return _ref8.apply(this, arguments);\n    };\n  }();\n  var formatTime = function formatTime(time) {\n    var options = {\n      hour: \"numeric\",\n      minute: \"numeric\"\n    };\n    return new Date(time).toLocaleString(\"en-US\", options);\n  };\n  var pickImage = function () {\n    var _ref9 = _asyncToGenerator(function* () {\n      var result = yield ImagePicker.launchImageLibraryAsync({\n        mediaTypes: ImagePicker.MediaTypeOptions.All,\n        allowsEditing: true,\n        aspect: [4, 3],\n        quality: 1\n      });\n      delete result.cancelled;\n      console.log(result);\n      if (!result.canceled) {\n        handleSend(\"image\", result.assets[0].uri);\n      }\n    });\n    return function pickImage() {\n      return _ref9.apply(this, arguments);\n    };\n  }();\n  var handleSelectMessage = function handleSelectMessage(message) {\n    var isSelected = selectedMessages.includes(message._id);\n    console.log(\"isSelected:\", isSelected);\n    if (isSelected) {\n      setSelectedMessages(function (previousMessages) {\n        return previousMessages.filter(function (id) {\n          return id !== message._id;\n        });\n      });\n    } else {\n      setSelectedMessages(function (previousMessages) {\n        return [].concat(_toConsumableArray(previousMessages), [message._id]);\n      });\n    }\n  };\n  var pickDocument = function () {\n    var _ref10 = _asyncToGenerator(function* () {\n      try {\n        var result = yield DocumentPicker.getDocumentAsync();\n        if (result.cancelled) {\n          return;\n        }\n        console.log(\"Document URI:\", result.uri);\n        handleSend(\"document\", result.uri);\n      } catch (error) {\n        console.log(\"Error picking document:\", error);\n      }\n    });\n    return function pickDocument() {\n      return _ref10.apply(this, arguments);\n    };\n  }();\n  return _jsxDEV(KeyboardAvoidingView, {\n    style: {\n      flex: 1,\n      backgroundColor: \"#F0F0F0\"\n    },\n    children: [_jsxDEV(ScrollView, {\n      ref: scrollViewRef,\n      contentContainerStyle: {\n        flexGrow: 1\n      },\n      onContentSizeChange: handleContentSizeChange,\n      children: messages.map(function (item, index) {\n        if (item.messageType === \"text\") {\n          var _usersDetais$find;\n          var isSelected = selectedMessages.includes(item._id);\n          console.log(\"recepientId:\", item.recepientId);\n          return _jsxDEV(Pressable, {\n            onLongPress: function onLongPress() {\n              return handleSelectMessage(item);\n            },\n            style: [(item == null ? void 0 : item.senderId) === userId ? {\n              alignSelf: \"flex-end\",\n              backgroundColor: \"#DCF8C6\",\n              padding: 8,\n              maxWidth: \"60%\",\n              borderRadius: 7,\n              margin: 10\n            } : {\n              alignSelf: \"flex-start\",\n              backgroundColor: \"white\",\n              padding: 8,\n              margin: 10,\n              borderRadius: 7,\n              maxWidth: \"60%\"\n            }, isSelected && {\n              width: \"100%\",\n              backgroundColor: \"#F0FFFF\"\n            }],\n            children: [_jsxDEV(View, {\n              style: {\n                flexDirection: \"row\"\n              },\n              children: [item.senderId !== userId && _jsxDEV(Image, {\n                style: {\n                  width: 25,\n                  height: 25,\n                  borderRadius: 25,\n                  resizeMode: \"cover\"\n                },\n                source: {\n                  uri: (_usersDetais$find = usersDetais.find(function (user) {\n                    return user._id === item.senderId;\n                  })) == null ? void 0 : _usersDetais$find.image\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 412,\n                columnNumber: 21\n              }, _this), _jsxDEV(Text, {\n                style: {\n                  fontSize: 20,\n                  marginHorizontal: 5,\n                  textAlign: isSelected ? \"right\" : \"left\"\n                },\n                children: item == null ? void 0 : item.message\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 426,\n                columnNumber: 19\n              }, _this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 395,\n              columnNumber: 17\n            }, _this), _jsxDEV(Text, {\n              style: {\n                textAlign: \"right\",\n                fontSize: 9,\n                color: \"gray\",\n                marginTop: 5\n              },\n              children: formatTime(item.timeStamp)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 436,\n              columnNumber: 17\n            }, _this)]\n          }, index, true, {\n            fileName: _jsxFileName,\n            lineNumber: 370,\n            columnNumber: 15\n          }, _this);\n        }\n        if (item.messageType === \"image\") {\n          var _usersDetais$find2;\n          var baseUrl = \"/Users/nganle/Downloads/realtime-chat-app/BackEnd/files/\";\n          var imageUrl = item.imageUrl;\n          var filename = imageUrl.split(\"/\").pop();\n          var source = {\n            uri: baseUrl + filename\n          };\n          console.log(\"source :\", source);\n          return _jsxDEV(Pressable, {\n            style: [(item == null ? void 0 : item.senderId) === userId ? {\n              alignSelf: \"flex-end\",\n              backgroundColor: \"#DCF8C6\",\n              padding: 8,\n              maxWidth: \"60%\",\n              borderRadius: 7,\n              margin: 10\n            } : {\n              alignSelf: \"flex-start\",\n              backgroundColor: \"white\",\n              padding: 8,\n              margin: 10,\n              borderRadius: 7,\n              maxWidth: \"60%\"\n            }],\n            children: _jsxDEV(View, {\n              children: [item.senderId !== userId && _jsxDEV(Image, {\n                style: {\n                  width: 25,\n                  height: 25,\n                  borderRadius: 25,\n                  resizeMode: \"cover\"\n                },\n                source: {\n                  uri: (_usersDetais$find2 = usersDetais.find(function (user) {\n                    return user._id === item.senderId;\n                  })) == null ? void 0 : _usersDetais$find2.image\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 499,\n                columnNumber: 21\n              }, _this), _jsxDEV(Image, {\n                source: source,\n                style: {\n                  width: 200,\n                  height: 200,\n                  borderRadius: 7\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 513,\n                columnNumber: 19\n              }, _this), _jsxDEV(Text, {\n                style: {\n                  textAlign: \"right\",\n                  fontSize: 9,\n                  position: \"absolute\",\n                  right: 10,\n                  bottom: 7,\n                  color: \"white\",\n                  marginTop: 5\n                },\n                children: formatTime(item == null ? void 0 : item.timeStamp)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 517,\n                columnNumber: 19\n              }, _this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 480,\n              columnNumber: 17\n            }, _this)\n          }, index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 458,\n            columnNumber: 15\n          }, _this);\n        }\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 360,\n      columnNumber: 7\n    }, this), _jsxDEV(View, {\n      style: {\n        flexDirection: \"row\",\n        alignItems: \"center\",\n        paddingHorizontal: 10,\n        paddingVertical: 10,\n        borderTopWidth: 1,\n        borderTopColor: \"#dddddd\",\n        marginBottom: showEmojiSelector ? 0 : 25\n      },\n      children: [_jsxDEV(Entypo, {\n        onPress: handleEmojiPress,\n        style: {\n          marginRight: 5\n        },\n        name: \"emoji-happy\",\n        size: 24,\n        color: \"gray\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 548,\n        columnNumber: 9\n      }, this), _jsxDEV(Entypo, {\n        name: \"attachment\",\n        size: 24,\n        color: \"black\",\n        onPress: pickDocument\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 556,\n        columnNumber: 9\n      }, this), _jsxDEV(TextInput, {\n        value: message,\n        onChangeText: function onChangeText(text) {\n          return setMessage(text);\n        },\n        style: {\n          flex: 1,\n          height: 40,\n          borderWidth: 1,\n          borderColor: \"#dddddd\",\n          borderRadius: 20,\n          paddingHorizontal: 10\n        },\n        placeholder: \"Type Your message...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 557,\n        columnNumber: 9\n      }, this), _jsxDEV(View, {\n        style: {\n          flexDirection: \"row\",\n          alignItems: \"center\",\n          gap: 7,\n          marginHorizontal: 8\n        },\n        children: [_jsxDEV(Entypo, {\n          onPress: pickImage,\n          name: \"camera\",\n          size: 24,\n          color: \"gray\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 579,\n          columnNumber: 11\n        }, this), _jsxDEV(Feather, {\n          name: \"mic\",\n          size: 24,\n          color: \"gray\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 581,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 571,\n        columnNumber: 9\n      }, this), _jsxDEV(Pressable, {\n        onPress: function onPress() {\n          return handleSend(\"text\");\n        },\n        style: {\n          backgroundColor: \"#007bff\",\n          paddingVertical: 8,\n          paddingHorizontal: 12,\n          borderRadius: 20\n        },\n        children: _jsxDEV(Text, {\n          style: {\n            color: \"white\",\n            fontWeight: \"bold\"\n          },\n          children: \"Send\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 593,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 584,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 537,\n      columnNumber: 7\n    }, this), showEmojiSelector && _jsxDEV(EmojiSelector, {\n      onEmojiSelected: function onEmojiSelected(emoji) {\n        setMessage(function (prevMessage) {\n          return prevMessage + emoji;\n        });\n      },\n      style: {\n        height: 250\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 598,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 359,\n    columnNumber: 5\n  }, this);\n}\nvar styles = StyleSheet.create({});","map":{"version":3,"names":["React","useState","useContext","useLayoutEffect","useEffect","useRef","Feather","Ionicons","FontAwesome","MaterialIcons","Entypo","EmojiSelector","UserType","useNavigation","useRoute","ImagePicker","io","DocumentPicker","AntDesign","jsxDEV","_jsxDEV","GroupChatScreen","_ref","_this","route","groupId","params","_useState","_useState2","_slicedToArray","showEmojiSelector","setShowEmojiSelector","_useState3","_useState4","selectedMessages","setSelectedMessages","_useState5","_useState6","messages","setMessages","_useState7","_useState8","recepientData","setRecepientData","navigation","_useState9","_useState10","selectedImage","setSelectedImage","_useState11","_useState12","group","setgroup","_useState13","_useState14","memberId","setMemberId","_useState15","_useState16","message","setMessage","_useContext","userId","setUserId","_useState17","_useState18","usersDetais","setUsersDetail","scrollViewRef","socketRef","fetchGroupInfo","_ref2","_asyncToGenerator","response","fetch","data","json","ok","memberIds","members","map","member","_id","console","log","status","error","apply","arguments","getDetailUserInGroup","_ref3","method","headers","body","JSON","stringify","userIds","Error","users","current","on","newMessage","prevMessages","concat","_toConsumableArray","_ref4","disconnect","scrollToBottom","scrollToEnd","animated","handleContentSizeChange","handleEmojiPress","fetchMessages","_ref5","fetchRecepientData","_ref6","handleSend","_ref7","messageType","imageUri","formData","FormData","append","uri","name","type","emit","senderId","recepientId","_x","_x2","handdleToDetailGroup","navigate","setOptions","headerTitle","headerLeft","View","style","flexDirection","alignItems","gap","marginLeft","children","onPress","goBack","size","color","fileName","_jsxFileName","lineNumber","columnNumber","length","Text","fontSize","fontWeight","headerRight","deleteMessages","marginRight","_ref8","messageIds","prevSelectedMessages","filter","id","includes","_x3","formatTime","time","options","hour","minute","Date","toLocaleString","pickImage","_ref9","result","launchImageLibraryAsync","mediaTypes","MediaTypeOptions","All","allowsEditing","aspect","quality","cancelled","canceled","assets","handleSelectMessage","isSelected","previousMessages","pickDocument","_ref10","getDocumentAsync","KeyboardAvoidingView","flex","backgroundColor","ScrollView","ref","contentContainerStyle","flexGrow","onContentSizeChange","item","index","_usersDetais$find","Pressable","onLongPress","alignSelf","padding","maxWidth","borderRadius","margin","width","Image","height","resizeMode","source","find","user","image","marginHorizontal","textAlign","marginTop","timeStamp","_usersDetais$find2","baseUrl","imageUrl","filename","split","pop","position","right","bottom","paddingHorizontal","paddingVertical","borderTopWidth","borderTopColor","marginBottom","TextInput","value","onChangeText","text","borderWidth","borderColor","placeholder","onEmojiSelected","emoji","prevMessage","styles","StyleSheet","create"],"sources":["D:/20045291/CNM/BTL/realtime-chat-app-main/FrontEnd/screens/GroupChatScreen.js"],"sourcesContent":["import {\n  StyleSheet,\n  Text,\n  View,\n  ScrollView,\n  KeyboardAvoidingView,\n  TextInput,\n  Pressable,\n  Image,\n} from \"react-native\";\nimport React, {\n  useState,\n  useContext,\n  useLayoutEffect,\n  useEffect,\n  useRef,\n} from \"react\";\nimport { Feather } from \"@expo/vector-icons\";\nimport { Ionicons } from \"@expo/vector-icons\";\nimport { FontAwesome } from \"@expo/vector-icons\";\nimport { MaterialIcons } from \"@expo/vector-icons\";\nimport { Entypo } from \"@expo/vector-icons\";\nimport EmojiSelector from \"react-native-emoji-selector\";\nimport { UserType } from \"../UserContext\";\nimport { useNavigation, useRoute } from \"@react-navigation/native\";\nimport * as ImagePicker from \"expo-image-picker\";\nimport { io } from \"socket.io-client\";\nimport * as DocumentPicker from \"expo-document-picker\";\nimport { AntDesign } from '@expo/vector-icons';\n\nexport default function GroupChatScreen({ route }) {\n  const { groupId } = route.params;\n\n  const [showEmojiSelector, setShowEmojiSelector] = useState(false);\n  const [selectedMessages, setSelectedMessages] = useState([]);\n  const [messages, setMessages] = useState([]);\n  const [recepientData, setRecepientData] = useState();\n  const navigation = useNavigation();\n  const [selectedImage, setSelectedImage] = useState(\"\");\n  const [group, setgroup] = useState();\n  const [memberId, setMemberId] = useState([]);\n  const [message, setMessage] = useState(\"\");\n  const { userId, setUserId } = useContext(UserType);\n  const [usersDetais, setUsersDetail] = useState([]);\n  // const [usersImages, setUsersImages] = useState([]);\n\n  const scrollViewRef = useRef(null);\n\n  const socketRef = useRef(null);\n\n  useEffect(() => {\n    // fetch thông tin group\n    const fetchGroupInfo = async () => {\n      try {\n        const response = await fetch(`http://localhost:8000/group/${groupId}`);\n        const data = await response.json();\n\n        if (response.ok) {\n          setgroup(data);\n\n          // lưu lại id của các thành viên trong mảng memberId\n          const memberIds = data.members.map((member) => member._id);\n          setMemberId(memberIds);\n          console.log(\"memberIds:\", memberIds);\n        } else {\n          console.log(\"error fetching group info\", response.status.message);\n        }\n      } catch (error) {\n        console.log(\"error fetching group info\", error);\n      }\n    };\n    fetchGroupInfo();\n  }, []);\n\n  useEffect(() => {\n    // fetch thông tin người dùng trong group\n    const getDetailUserInGroup = async () => {\n      try {\n        const response = await fetch(\"http://localhost:8000/groups/users\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify({ userIds: memberId }),\n        });\n\n        if (!response.ok) {\n          throw new Error(\"Lỗi khi truy vấn người dùng\");\n        }\n\n        const users = await response.json();\n\n        // console.log(\"Danh sách người dùng:\", users);\n        setUsersDetail(users);\n        console.log(\"danh sách nguoi dung:\", usersDetais);\n        return users;\n      } catch (error) {\n        console.error(\"Lỗi khi gửi yêu cầu:\", error);\n        return null;\n      }\n    };\n    getDetailUserInGroup();\n  }, [memberId]);\n\n  useEffect(() => {\n    // Kết nối với máy chủ Socket.io khi component được tạo\n    socketRef.current = io(\"http://localhost:8000\");\n\n    // Lắng nghe sự kiện \"newMessage\" từ máy chủ và cập nhật danh sách tin nhắn\n    socketRef.current.on(\"newMessageGroup\", (newMessage) => {\n      setMessages((prevMessages) => [...prevMessages, newMessage]);\n    });\n\n    // Lắng nghe sự kiện \"sendMessage\" từ máy chủ và cập nhật danh sách tin nhắn\n    socketRef.current.on(\"sendMessageGroup\", ({ newMessage }) => {\n      setMessages((prevMessages) => [...prevMessages, newMessage]);\n    });\n\n    // Đảm bảo rằng bạn ngắt kết nối khi component unmount\n    return () => {\n      socketRef.current.disconnect();\n    };\n  }, []);\n\n  useEffect(() => {\n    scrollToBottom();\n  }, []);\n\n  const scrollToBottom = () => {\n    if (scrollViewRef.current) {\n      scrollViewRef.current.scrollToEnd({ animated: false });\n    }\n  };\n\n  const handleContentSizeChange = () => {\n    scrollToBottom();\n  };\n\n  const handleEmojiPress = () => {\n    setShowEmojiSelector(!showEmojiSelector);\n  };\n\n  const fetchMessages = async () => {\n    try {\n      const response = await fetch(\n        `http://localhost:8000/group-messages/${groupId}`\n      );\n      const data = await response.json();\n\n      if (response.ok) {\n        setMessages(data);\n      } else {\n        console.log(\"error showing messags\", response.status.message);\n      }\n    } catch (error) {\n      console.log(\"error fetching messages\", error);\n    }\n  };\n\n  useEffect(() => {\n    fetchMessages();\n  }, []);\n\n  \n\n  useEffect(() => {\n    const fetchRecepientData = async () => {\n      try {\n        const response = await fetch(\n          `http://localhost:8000/group-messages/${groupId}`\n        );\n\n        const data = await response.json();\n        setRecepientData(data);\n        console.log(\"recepient data:\", data);\n      } catch (error) {\n        console.log(\"error retrieving details\", error);\n      }\n    };\n\n    fetchRecepientData();\n  }, []);\n\n  const handleSend = async (messageType, imageUri) => {\n    try {\n      const formData = new FormData();\n      formData.append(\"senderId\", userId);\n      formData.append(\"groupId\", groupId); // Add groupId to formData\n\n      formData.append(\"recepientId\", memberId);\n\n      // Check if the message type is image or a normal text\n      if (messageType === \"image\") {\n        formData.append(\"messageType\", \"image\");\n        formData.append(\"imageFile\", {\n          uri: imageUri,\n          name: \"image.jpg\",\n          type: \"image/jpeg\",\n        });\n      } else {\n        formData.append(\"messageType\", \"text\");\n        formData.append(\"messageText\", message);\n      }\n\n      const response = await fetch(\"http://localhost:8000/group-messages\", {\n        method: \"POST\",\n        body: formData,\n      });\n\n      if (response.ok) {\n        setMessage(\"\");\n        setSelectedImage(\"\");\n        // Notify the server and recipient about the new event\n        socketRef.current.emit(\"sendMessage\", {\n          senderId: userId,\n          recepientId: memberId,\n          newMessage: response.newMessage, // Modify this line based on your server response\n        });\n\n        // Fetch the message list to update the interface\n        fetchMessages();\n      }\n    } catch (error) {\n      console.log(\"error in sending the message\", error);\n    }\n  };\n\n  const handdleToDetailGroup = () => {\n    navigation.navigate(\"GroupInfoScreen\", {\n      groupId: groupId,\n      \n      \n    });\n  }\n\n  useLayoutEffect(() => {\n    navigation.setOptions({\n      headerTitle: \"\",\n      headerLeft: () => (\n        <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 10, marginLeft:10, }}>\n          <Ionicons\n            onPress={() => navigation.goBack()}\n            name=\"arrow-back\"\n            size={24}\n            color=\"black\"\n          />\n\n          {selectedMessages.length > 0 ? (\n            <View>\n              <Text style={{ fontSize: 16, fontWeight: \"500\" }}>\n                {selectedMessages.length}\n              </Text>\n            </View>\n          ) : (\n            <View style={{ flexDirection: \"row\", alignItems: \"center\" }}>\n              <Text style={{ marginLeft: 10, fontSize: 20, fontWeight: \"bold\" }}>\n                {group?.name}\n              </Text>\n            </View>\n          )}\n        </View>\n      ),\n      headerRight: () =>\n        selectedMessages.length > 0 ? (\n          <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 10, }}>\n            <Ionicons name=\"arrow-redo-sharp\" size={24} color=\"black\" />\n            <Ionicons name=\"arrow-undo\" size={24} color=\"black\" />\n            <FontAwesome name=\"star\" size={24} color=\"black\" />\n            <MaterialIcons\n              onPress={() => deleteMessages(selectedMessages)}\n              name=\"delete\"\n              size={24}\n              color=\"black\"\n            />\n            \n          </View>\n        ) : <View><AntDesign name=\"bars\" size={24} color=\"black\" onPress={handdleToDetailGroup} style={{marginRight:10,}} /></View>,\n    });\n  }, [recepientData, selectedMessages]);\n\n  const deleteMessages = async (messageIds) => {\n    try {\n      const response = await fetch(\"http://localhost:8000/deleteMessages\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ messages: messageIds }),\n      });\n\n      if (response.ok) {\n        setSelectedMessages((prevSelectedMessages) =>\n          prevSelectedMessages.filter((id) => !messageIds.includes(id))\n        );\n\n        fetchMessages();\n      } else {\n        console.log(\"error deleting messages\", response.status);\n      }\n    } catch (error) {\n      console.log(\"error deleting messages\", error);\n    }\n  };\n  const formatTime = (time) => {\n    const options = { hour: \"numeric\", minute: \"numeric\" };\n    return new Date(time).toLocaleString(\"en-US\", options);\n  };\n\n  const pickImage = async () => {\n    let result = await ImagePicker.launchImageLibraryAsync({\n      mediaTypes: ImagePicker.MediaTypeOptions.All,\n      allowsEditing: true,\n      aspect: [4, 3],\n      quality: 1,\n    });\n    delete result.cancelled;\n    console.log(result);\n    if (!result.canceled) {\n      handleSend(\"image\", result.assets[0].uri);\n    }\n  };\n  const handleSelectMessage = (message) => {\n    //check if the message is already selected\n    const isSelected = selectedMessages.includes(message._id);\n    console.log(\"isSelected:\", isSelected);\n\n    if (isSelected) {\n      setSelectedMessages((previousMessages) =>\n        previousMessages.filter((id) => id !== message._id)\n      );\n    } else {\n      setSelectedMessages((previousMessages) => [\n        ...previousMessages,\n        message._id,\n      ]);\n    }\n  };\n\n  const pickDocument = async () => {\n    try {\n      const result = await DocumentPicker.getDocumentAsync();\n\n      // Check if the user canceled the picker\n      if (result.cancelled) {\n        return;\n      }\n\n      // You can now use result.uri to upload the document file to your server\n      console.log(\"Document URI:\", result.uri);\n\n      // Handle the document file upload\n      handleSend(\"document\", result.uri);\n    } catch (error) {\n      console.log(\"Error picking document:\", error);\n    }\n  };\n\n  return (\n    <KeyboardAvoidingView style={{ flex: 1, backgroundColor: \"#F0F0F0\" }}>\n      <ScrollView\n        ref={scrollViewRef}\n        contentContainerStyle={{ flexGrow: 1 }}\n        onContentSizeChange={handleContentSizeChange}\n      >\n        {messages.map((item, index) => {\n          if (item.messageType === \"text\") {\n            const isSelected = selectedMessages.includes(item._id);\n            console.log(\"recepientId:\", item.recepientId);\n            return (\n              <Pressable\n                onLongPress={() => handleSelectMessage(item)}\n                key={index}\n                style={[\n                  item?.senderId === userId\n                    ? {\n                        alignSelf: \"flex-end\",\n                        backgroundColor: \"#DCF8C6\",\n                        padding: 8,\n                        maxWidth: \"60%\",\n                        borderRadius: 7,\n                        margin: 10,\n                      }\n                    : {\n                        alignSelf: \"flex-start\",\n                        backgroundColor: \"white\",\n                        padding: 8,\n                        margin: 10,\n                        borderRadius: 7,\n                        maxWidth: \"60%\",\n                      },\n\n                  isSelected && { width: \"100%\", backgroundColor: \"#F0FFFF\" },\n                ]}\n              >\n                <View style={{ flexDirection: \"row\" }}>\n                  {/* // hiển thị ảnh đại diện của người gửi tin nhắn */}\n\n                  {/* <Image\n                    style={{\n                      width: 25,\n                      height: 25,\n                      borderRadius: 25,\n                      resizeMode: \"cover\",\n                    }}\n                    source={{\n                      uri: usersDetais.find(\n                        (user) => user._id === item.senderId\n                      )?.image,\n                    }}\n                  /> */}\n                  {item.senderId !== userId && (\n                    <Image\n                      style={{\n                        width: 25,\n                        height: 25,\n                        borderRadius: 25,\n                        resizeMode: \"cover\",\n                      }}\n                      source={{\n                        uri: usersDetais.find(\n                          (user) => user._id === item.senderId\n                        )?.image,\n                      }}\n                    />\n                  )}\n                  <Text\n                    style={{\n                      fontSize: 20,\n                      marginHorizontal: 5,\n                      textAlign: isSelected ? \"right\" : \"left\",\n                    }}\n                  >\n                    {item?.message}\n                  </Text>\n                </View>\n                <Text\n                  style={{\n                    textAlign: \"right\",\n                    fontSize: 9,\n                    color: \"gray\",\n                    marginTop: 5,\n                  }}\n                >\n                  {formatTime(item.timeStamp)}\n                </Text>\n              </Pressable>\n            );\n          }\n\n          if (item.messageType === \"image\") {\n            const baseUrl = \"/Users/nganle/Downloads/realtime-chat-app/BackEnd/files/\";\n\n            const imageUrl = item.imageUrl;\n            const filename = imageUrl.split(\"/\").pop();\n            const source = { uri: baseUrl + filename };\n            console.log(\"source :\", source);\n            return (\n              <Pressable\n                key={index}\n                style={[\n                  item?.senderId === userId\n                    ? {\n                        alignSelf: \"flex-end\",\n                        backgroundColor: \"#DCF8C6\",\n                        padding: 8,\n                        maxWidth: \"60%\",\n                        borderRadius: 7,\n                        margin: 10,\n                      }\n                    : {\n                        alignSelf: \"flex-start\",\n                        backgroundColor: \"white\",\n                        padding: 8,\n                        margin: 10,\n                        borderRadius: 7,\n                        maxWidth: \"60%\",\n                      },\n                ]}\n              >\n                <View>\n                  {/* ảnh đại diện  */}\n                  {/* <Image\n                    style={{\n                      width: 25,\n                      height: 25,\n                      borderRadius: 25,\n                      resizeMode: \"contain\",\n                      borderColor: \"gray\",\n                      borderWidth: 1,\n                    }}\n                    source={{\n                      uri: usersDetais.find(\n                        (user) => user._id === item.senderId\n                      )?.image,\n                    }}\n                  /> */}\n\n                  {item.senderId !== userId && (\n                    <Image\n                      style={{\n                        width: 25,\n                        height: 25,\n                        borderRadius: 25,\n                        resizeMode: \"cover\",\n                      }}\n                      source={{\n                        uri: usersDetais.find(\n                          (user) => user._id === item.senderId\n                        )?.image,\n                      }}\n                    />\n                  )}\n                  <Image\n                    source={source}\n                    style={{ width: 200, height: 200, borderRadius: 7 }}\n                  />\n                  <Text\n                    style={{\n                      textAlign: \"right\",\n                      fontSize: 9,\n                      position: \"absolute\",\n                      right: 10,\n                      bottom: 7,\n                      color: \"white\",\n                      marginTop: 5,\n                    }}\n                  >\n                    {formatTime(item?.timeStamp)}\n                  </Text>\n                </View>\n              </Pressable>\n            );\n          }\n        })}\n      </ScrollView>\n\n      <View\n        style={{\n          flexDirection: \"row\",\n          alignItems: \"center\",\n          paddingHorizontal: 10,\n          paddingVertical: 10,\n          borderTopWidth: 1,\n          borderTopColor: \"#dddddd\",\n          marginBottom: showEmojiSelector ? 0 : 25,\n        }}\n      >\n        <Entypo\n          onPress={handleEmojiPress}\n          style={{ marginRight: 5 }}\n          name=\"emoji-happy\"\n          size={24}\n          color=\"gray\"\n        />\n        \n        <Entypo name=\"attachment\" size={24} color=\"black\" onPress={pickDocument}/>\n        <TextInput\n          value={message}\n          onChangeText={(text) => setMessage(text)}\n          style={{\n            flex: 1,\n            height: 40,\n            borderWidth: 1,\n            borderColor: \"#dddddd\",\n            borderRadius: 20,\n            paddingHorizontal: 10,\n          }}\n          placeholder=\"Type Your message...\"\n        />\n\n        <View\n          style={{\n            flexDirection: \"row\",\n            alignItems: \"center\",\n            gap: 7,\n            marginHorizontal: 8,\n          }}\n        >\n          <Entypo onPress={pickImage} name=\"camera\" size={24} color=\"gray\" />\n\n          <Feather name=\"mic\" size={24} color=\"gray\" />\n        </View>\n\n        <Pressable\n          onPress={() => handleSend(\"text\")}\n          style={{\n            backgroundColor: \"#007bff\",\n            paddingVertical: 8,\n            paddingHorizontal: 12,\n            borderRadius: 20,\n          }}\n        >\n          <Text style={{ color: \"white\", fontWeight: \"bold\" }}>Send</Text>\n        </Pressable>\n      </View>\n\n      {showEmojiSelector && (\n        <EmojiSelector\n          onEmojiSelected={(emoji) => {\n            setMessage((prevMessage) => prevMessage + emoji);\n          }}\n          style={{ height: 250 }}\n        />\n      )}\n    </KeyboardAvoidingView>\n  );\n}\n\nconst styles = StyleSheet.create({});\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
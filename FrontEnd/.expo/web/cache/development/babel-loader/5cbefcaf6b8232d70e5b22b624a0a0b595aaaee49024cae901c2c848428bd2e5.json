{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"D:\\\\20045291\\\\CNM\\\\BTL\\\\realtime-chat-app-main\\\\FrontEnd\\\\screens\\\\ChatMessagesScreen.js\",\n  _this = this;\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport ScrollView from \"react-native-web/dist/exports/ScrollView\";\nimport KeyboardAvoidingView from \"react-native-web/dist/exports/KeyboardAvoidingView\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport Pressable from \"react-native-web/dist/exports/Pressable\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport Modal from \"react-native-web/dist/exports/Modal\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport Dimensions from \"react-native-web/dist/exports/Dimensions\";\nimport Linking from \"react-native-web/dist/exports/Linking\";\nimport React, { useState, useContext, useLayoutEffect, useEffect, useRef } from \"react\";\nimport { Feather } from \"@expo/vector-icons\";\nimport { Ionicons } from \"@expo/vector-icons\";\nimport { FontAwesome, AntDesign } from \"@expo/vector-icons\";\nimport { MaterialIcons } from \"@expo/vector-icons\";\nimport { Entypo } from \"@expo/vector-icons\";\nimport EmojiSelector from \"react-native-emoji-selector\";\nimport { UserType } from \"../UserContext\";\nimport { useNavigation, useRoute } from \"@react-navigation/native\";\nimport * as ImagePicker from \"expo-image-picker\";\nimport { Socket, io } from \"socket.io-client\";\nimport * as FileSystem from 'expo-file-system';\nimport { PDFReader } from 'rn-pdf-reader-js';\nimport * as DocumentPicker from \"expo-document-picker\";\nimport { Octicons } from \"@expo/vector-icons\";\nimport UserChat from \"../components/UserChat\";\nimport WebView from \"react-native-webview\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar ChatMessagesScreen = function ChatMessagesScreen() {\n  var _useState = useState(false),\n    _useState2 = _slicedToArray(_useState, 2),\n    showEmojiSelector = _useState2[0],\n    setShowEmojiSelector = _useState2[1];\n  var _useState3 = useState([]),\n    _useState4 = _slicedToArray(_useState3, 2),\n    selectedMessages = _useState4[0],\n    setSelectedMessages = _useState4[1];\n  var _useState5 = useState([]),\n    _useState6 = _slicedToArray(_useState5, 2),\n    messages = _useState6[0],\n    setMessages = _useState6[1];\n  var _useState7 = useState(),\n    _useState8 = _slicedToArray(_useState7, 2),\n    recepientData = _useState8[0],\n    setRecepientData = _useState8[1];\n  var navigation = useNavigation();\n  var _useState9 = useState(\"\"),\n    _useState10 = _slicedToArray(_useState9, 2),\n    selectedImage = _useState10[0],\n    setSelectedImage = _useState10[1];\n  var route = useRoute();\n  var recepientId = route.params.recepientId;\n  var _useState11 = useState(\"\"),\n    _useState12 = _slicedToArray(_useState11, 2),\n    message = _useState12[0],\n    setMessage = _useState12[1];\n  var _useContext = useContext(UserType),\n    userId = _useContext.userId,\n    setUserId = _useContext.setUserId;\n  var _useState13 = useState([]),\n    _useState14 = _slicedToArray(_useState13, 2),\n    acceptedFriends = _useState14[0],\n    setAcceptedFriends = _useState14[1];\n  var _useState15 = useState(null),\n    _useState16 = _slicedToArray(_useState15, 2),\n    itemIndex = _useState16[0],\n    setItemIndex = _useState16[1];\n  var scrollViewRef = useRef(null);\n  var _useState17 = useState(),\n    _useState18 = _slicedToArray(_useState17, 2),\n    selectedImageShare = _useState18[0],\n    setSelectedImageShare = _useState18[1];\n  var _useState19 = useState(false),\n    _useState20 = _slicedToArray(_useState19, 2),\n    modalVisible = _useState20[0],\n    setModalVisible = _useState20[1];\n  var _useState21 = useState(null),\n    _useState22 = _slicedToArray(_useState21, 2),\n    source = _useState22[0],\n    setSource = _useState22[1];\n  var socketRef = useRef(null);\n  useEffect(function () {\n    socketRef.current = io(\"localhost:8000\");\n    socketRef.current.on(\"newMessage\", function (newMessage) {\n      setMessages(function (prevMessages) {\n        return [].concat(_toConsumableArray(prevMessages), [newMessage]);\n      });\n    });\n    socketRef.current.on(\"sendMessage\", function (_ref) {\n      var newMessage = _ref.newMessage;\n      setMessages(function (prevMessages) {\n        return [].concat(_toConsumableArray(prevMessages), [newMessage]);\n      });\n    });\n    socketRef.current.on(\"deleteMessages\", function (_ref2) {\n      var messageIds = _ref2.messageIds;\n      setMessages(function (prevMessages) {\n        return prevMessages.filter(function (message) {\n          return !messageIds.includes(message._id);\n        });\n      });\n    });\n    return function () {\n      socketRef.current.disconnect();\n    };\n  }, []);\n  useEffect(function () {\n    scrollToBottom();\n  }, []);\n  var scrollToBottom = function scrollToBottom() {\n    if (scrollViewRef.current) {\n      scrollViewRef.current.scrollToEnd({\n        animated: false\n      });\n    }\n  };\n  var handleContentSizeChange = function handleContentSizeChange() {\n    scrollToBottom();\n  };\n  var handleEmojiPress = function handleEmojiPress() {\n    setShowEmojiSelector(!showEmojiSelector);\n  };\n  var fetchMessages = function () {\n    var _ref3 = _asyncToGenerator(function* () {\n      try {\n        var response = yield fetch(`localhost:8000/messages/${userId}/${recepientId}`);\n        var data = yield response.json();\n        if (response.ok) {\n          setMessages(data);\n        } else {\n          console.log(\"error showing messags\", response.status.message);\n        }\n      } catch (error) {\n        console.log(\"error fetching messages\", error);\n      }\n    });\n    return function fetchMessages() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  var handleShareMessage = function handleShareMessage() {\n    setModalVisible(true);\n  };\n  useEffect(function () {\n    fetchMessages();\n  }, []);\n  useEffect(function () {\n    var acceptedFriendsList = function () {\n      var _ref4 = _asyncToGenerator(function* () {\n        try {\n          var response = yield fetch(`localhost:8000/accepted-friends/${userId}`);\n          var data = yield response.json();\n          if (response.ok) {\n            setAcceptedFriends(data);\n          }\n        } catch (error) {\n          console.log(\"error showing the accepted friends\", error);\n        }\n      });\n      return function acceptedFriendsList() {\n        return _ref4.apply(this, arguments);\n      };\n    }();\n    acceptedFriendsList();\n  }, []);\n  var handleShareMessageFriend = function () {\n    var _ref5 = _asyncToGenerator(function* (item) {\n      var recepientId = item._id;\n      try {\n        var formData = new FormData();\n        formData.append(\"senderId\", userId);\n        formData.append(\"recepientId\", recepientId);\n        console.log(\"messageType:\", messages[itemIndex].messageType);\n        console.log(\"messageText:\", messages[itemIndex].message);\n        if (messages[itemIndex].messageType === \"image\") {\n          formData.append(\"messageType\", \"image\");\n          formData.append(\"imageFile\", {\n            uri: selectedImageShare.uri,\n            name: \"image.jpg\",\n            type: \"image/jpeg\"\n          });\n        } else {\n          formData.append(\"messageType\", \"text\");\n          formData.append(\"messageText\", messages[itemIndex].message);\n        }\n        var response = yield fetch(\"localhost:8000/messages\", {\n          method: \"POST\",\n          body: formData\n        });\n        if (response.ok) {\n          setMessage(\"\");\n          setSelectedImage(\"\");\n          socketRef.current.emit(\"sendMessage\", {\n            senderId: userId,\n            recepientId: recepientId,\n            newMessage: response.newMessage\n          });\n          console.log(\"newMessage:\", response.newMessage);\n          console.log(\"senderId:\", userId);\n          console.log(\"recepientId:\", recepientId);\n          fetchMessages();\n        }\n        setModalVisible(!modalVisible);\n      } catch (error) {\n        console.log(\"error sending message\", error);\n      }\n    });\n    return function handleShareMessageFriend(_x) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n  useEffect(function () {\n    var fetchRecepientData = function () {\n      var _ref6 = _asyncToGenerator(function* () {\n        try {\n          var response = yield fetch(`localhost:8000/user/${recepientId}`);\n          var data = yield response.json();\n          setRecepientData(data);\n        } catch (error) {\n          console.log(\"error retrieving details\", error);\n        }\n      });\n      return function fetchRecepientData() {\n        return _ref6.apply(this, arguments);\n      };\n    }();\n    fetchRecepientData();\n  }, [recepientData]);\n  var handleSend = function () {\n    var _ref7 = _asyncToGenerator(function* (messageType, imageUri, fileName) {\n      try {\n        var formData = new FormData();\n        formData.append(\"senderId\", userId);\n        formData.append(\"recepientId\", recepientId);\n        if (messageType === \"image\") {\n          formData.append(\"messageType\", \"image\");\n          formData.append(\"file\", {\n            uri: imageUri,\n            name: \"image.jpg\",\n            type: \"image/jpeg\"\n          });\n        } else if (messageType === \"document\") {\n          formData.append(\"messageType\", \"document\");\n          formData.append(\"fileName\", fileName);\n          formData.append(\"file\", {\n            uri: imageUri,\n            name: \"document.pdf\",\n            type: \"application/pdf\"\n          });\n        } else {\n          formData.append(\"messageType\", \"text\");\n          formData.append(\"messageText\", message);\n        }\n        var response = yield fetch(\"localhost:8000/messages\", {\n          method: \"POST\",\n          body: formData\n        });\n        if (response.ok) {\n          setMessage(\"\");\n          setSelectedImage(\"\");\n          socketRef.current.emit(\"sendMessage\", {\n            senderId: userId,\n            recepientId: recepientId,\n            newMessage: response.newMessage\n          });\n          fetchMessages();\n        }\n      } catch (error) {\n        console.log(\"error in sending the message\", error);\n      }\n    });\n    return function handleSend(_x2, _x3, _x4) {\n      return _ref7.apply(this, arguments);\n    };\n  }();\n  useEffect(function () {\n    if (recepientData && recepientData.image) {\n      var baseUrl = \"/Users/nganle/Downloads/realtime-chat-app/BackEnd/\";\n      var imageUrl = recepientData.image;\n      var _source = {\n        uri: baseUrl + imageUrl\n      };\n      setSource(_source);\n      console.log(\"source :\", _source);\n    }\n  }, [recepientData]);\n  useLayoutEffect(function () {\n    navigation.setOptions({\n      headerTitle: \"\",\n      headerLeft: function headerLeft() {\n        return _jsxDEV(View, {\n          style: {\n            flexDirection: \"row\",\n            alignItems: \"center\",\n            gap: 10\n          },\n          children: [_jsxDEV(Ionicons, {\n            onPress: function onPress() {\n              return navigation.goBack();\n            },\n            name: \"arrow-back\",\n            size: 24,\n            color: \"black\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 291,\n            columnNumber: 11\n          }, _this), selectedMessages.length > 0 ? _jsxDEV(View, {\n            children: _jsxDEV(Text, {\n              style: {\n                fontSize: 16,\n                fontWeight: \"500\"\n              },\n              children: selectedMessages.length\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 300,\n              columnNumber: 15\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 299,\n            columnNumber: 13\n          }, _this) : _jsxDEV(View, {\n            style: {\n              flexDirection: \"row\",\n              alignItems: \"center\"\n            },\n            children: [_jsxDEV(Image, {\n              style: {\n                width: 30,\n                height: 30,\n                borderRadius: 15,\n                resizeMode: \"cover\"\n              },\n              source: source\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 306,\n              columnNumber: 15\n            }, _this), _jsxDEV(Text, {\n              style: {\n                marginLeft: 5,\n                fontSize: 15,\n                fontWeight: \"bold\"\n              },\n              children: recepientData == null ? void 0 : recepientData.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 316,\n              columnNumber: 15\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 305,\n            columnNumber: 13\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 290,\n          columnNumber: 9\n        }, _this);\n      },\n      headerRight: function headerRight() {\n        return selectedMessages.length > 0 ? _jsxDEV(View, {\n          style: {\n            flexDirection: \"row\",\n            alignItems: \"center\",\n            gap: 10\n          },\n          children: [_jsxDEV(Pressable, {\n            style: [styles.button, styles.buttonOpen],\n            onPress: handleShareMessage,\n            children: _jsxDEV(Ionicons, {\n              name: \"arrow-undo\",\n              size: 24,\n              color: \"black\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 333,\n              columnNumber: 15\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 329,\n            columnNumber: 13\n          }, _this), _jsxDEV(FontAwesome, {\n            name: \"star\",\n            size: 24,\n            color: \"black\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 336,\n            columnNumber: 13\n          }, _this), _jsxDEV(MaterialIcons, {\n            onPress: function onPress() {\n              return deleteMessages(selectedMessages);\n            },\n            name: \"delete\",\n            size: 24,\n            color: \"black\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 337,\n            columnNumber: 13\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 325,\n          columnNumber: 11\n        }, _this) : null;\n      }\n    });\n  }, [recepientData, selectedMessages]);\n  var deleteMessages = function () {\n    var _ref8 = _asyncToGenerator(function* (messageIds) {\n      try {\n        var response = yield fetch(\"localhost:8000/deleteMessages\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          body: JSON.stringify({\n            messages: messageIds\n          })\n        });\n        if (response.ok) {\n          setSelectedMessages(function (prevSelectedMessages) {\n            return prevSelectedMessages.filter(function (id) {\n              return !messageIds.includes(id);\n            });\n          });\n          socketRef.current.emit(\"deleteMessages\", {\n            messageIds: messageIds\n          });\n          fetchMessages();\n        } else {\n          console.log(\"error deleting messages\", response.status);\n        }\n      } catch (error) {\n        console.log(\"error deleting messages\", error);\n      }\n    });\n    return function deleteMessages(_x5) {\n      return _ref8.apply(this, arguments);\n    };\n  }();\n  var formatTime = function formatTime(time) {\n    var options = {\n      hour: \"numeric\",\n      minute: \"numeric\"\n    };\n    return new Date(time).toLocaleString(\"en-US\", options);\n  };\n  var pickImage = function () {\n    var _ref9 = _asyncToGenerator(function* () {\n      var result = yield ImagePicker.launchImageLibraryAsync({\n        mediaTypes: ImagePicker.MediaTypeOptions.All,\n        allowsEditing: true,\n        aspect: [4, 3],\n        quality: 1\n      });\n      delete result.canceled;\n      console.log(result.assets[0].uri);\n      if (!result.canceled) {\n        handleSend(\"image\", result.assets[0].uri);\n      }\n    });\n    return function pickImage() {\n      return _ref9.apply(this, arguments);\n    };\n  }();\n  var handleSelectMessage = function handleSelectMessage(message, index, source) {\n    var isSelected = selectedMessages.includes(message._id);\n    setItemIndex(index);\n    setSelectedImageShare(source);\n    if (isSelected) {\n      setSelectedMessages(function (previousMessages) {\n        return previousMessages.filter(function (id) {\n          return id !== message._id;\n        });\n      });\n    } else {\n      setSelectedMessages(function (previousMessages) {\n        return [].concat(_toConsumableArray(previousMessages), [message._id]);\n      });\n    }\n  };\n  var pickDocument = function () {\n    var _ref10 = _asyncToGenerator(function* () {\n      try {\n        var result = yield DocumentPicker.getDocumentAsync();\n        if (result.canceled) {\n          return;\n        }\n        handleSend(\"document\", result.assets[0].uri, result.assets[0].name);\n      } catch (error) {\n        console.log(\"Error picking document:\", error);\n      }\n    });\n    return function pickDocument() {\n      return _ref10.apply(this, arguments);\n    };\n  }();\n  var handleReadDocument = function () {\n    var _ref11 = _asyncToGenerator(function* (item, index, source) {\n      var uri = source;\n    });\n    return function handleReadDocument(_x6, _x7, _x8) {\n      return _ref11.apply(this, arguments);\n    };\n  }();\n  return _jsxDEV(KeyboardAvoidingView, {\n    style: {\n      flex: 1,\n      backgroundColor: \"#F0F0F0\"\n    },\n    children: [_jsxDEV(ScrollView, {\n      ref: scrollViewRef,\n      contentContainerStyle: {\n        flexGrow: 1\n      },\n      onContentSizeChange: handleContentSizeChange,\n      children: messages.map(function (item, index) {\n        if (item.messageType === \"text\") {\n          var _item$senderId;\n          var isSelected = selectedMessages.includes(item._id);\n          return _jsxDEV(Pressable, {\n            onLongPress: function onLongPress() {\n              return handleSelectMessage(item, index);\n            },\n            style: [(item == null ? void 0 : (_item$senderId = item.senderId) == null ? void 0 : _item$senderId._id) === userId ? {\n              alignSelf: \"flex-end\",\n              backgroundColor: \"#DCF8C6\",\n              padding: 8,\n              maxWidth: \"60%\",\n              borderRadius: 7,\n              margin: 10\n            } : {\n              alignSelf: \"flex-start\",\n              backgroundColor: \"white\",\n              padding: 8,\n              margin: 10,\n              borderRadius: 7,\n              maxWidth: \"60%\"\n            }, isSelected && {\n              width: \"100%\",\n              backgroundColor: \"#F0FFFF\"\n            }],\n            children: [_jsxDEV(Text, {\n              style: {\n                fontSize: 13,\n                textAlign: isSelected ? \"right\" : \"left\"\n              },\n              children: item == null ? void 0 : item.message\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 470,\n              columnNumber: 17\n            }, _this), _jsxDEV(Text, {\n              style: {\n                textAlign: \"right\",\n                fontSize: 9,\n                color: \"gray\",\n                marginTop: 5\n              },\n              children: formatTime(item.timeStamp)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 478,\n              columnNumber: 17\n            }, _this)]\n          }, index, true, {\n            fileName: _jsxFileName,\n            lineNumber: 445,\n            columnNumber: 15\n          }, _this);\n        }\n        if (item.messageType === \"image\") {\n          if (item.imageUrl) {\n            var _item$senderId2;\n            var baseUrl = \"/Users/nganle/Downloads/realtime-chat-app/BackEnd/files/\";\n            var imageUrl = item.imageUrl;\n            var filename = imageUrl.split(\"/\").pop();\n            var _source2 = {\n              uri: baseUrl + filename\n            };\n            return _jsxDEV(TouchableOpacity, {\n              onLongPress: function onLongPress() {\n                return handleSelectMessage(item, index, _source2);\n              },\n              style: [(item == null ? void 0 : (_item$senderId2 = item.senderId) == null ? void 0 : _item$senderId2._id) === userId ? {\n                alignSelf: \"flex-end\",\n                backgroundColor: \"#DCF8C6\",\n                padding: 8,\n                maxWidth: \"60%\",\n                borderRadius: 7,\n                margin: 10\n              } : {\n                alignSelf: \"flex-start\",\n                backgroundColor: \"white\",\n                padding: 8,\n                margin: 10,\n                borderRadius: 7,\n                maxWidth: \"60%\"\n              }],\n              children: _jsxDEV(View, {\n                children: [_jsxDEV(Image, {\n                  source: _source2,\n                  style: {\n                    width: 200,\n                    height: 200,\n                    borderRadius: 7\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 526,\n                  columnNumber: 21\n                }, _this), _jsxDEV(Text, {\n                  style: {\n                    textAlign: \"right\",\n                    fontSize: 9,\n                    position: \"absolute\",\n                    right: 10,\n                    bottom: 7,\n                    color: \"white\",\n                    marginTop: 5\n                  },\n                  children: formatTime(item == null ? void 0 : item.timeStamp)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 530,\n                  columnNumber: 21\n                }, _this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 525,\n                columnNumber: 19\n              }, _this)\n            }, index, false, {\n              fileName: _jsxFileName,\n              lineNumber: 502,\n              columnNumber: 17\n            }, _this);\n          }\n        }\n        if (item.messageType === \"document\") {\n          if (item.documentUrl) {\n            var _item$senderId3;\n            var _baseUrl = \"/Users/nganle/Downloads/realtime-chat-app/BackEnd/files/\";\n            var documentUrl = item.documentUrl;\n            var _filename = documentUrl.split(\"/\").pop();\n            var _source3 = {\n              uri: _baseUrl + _filename\n            };\n            console.log(\"source pdf:\", _source3);\n            return _jsxDEV(TouchableOpacity, {\n              onPress: function onPress() {\n                return handleReadDocument(item, index, _source3);\n              },\n              onLongPress: function onLongPress() {\n                return handleSelectMessage(item, index, _source3);\n              },\n              style: [(item == null ? void 0 : (_item$senderId3 = item.senderId) == null ? void 0 : _item$senderId3._id) === userId ? {\n                alignSelf: \"flex-end\",\n                backgroundColor: \"#DCF8C6\",\n                padding: 8,\n                maxWidth: \"60%\",\n                borderRadius: 7,\n                margin: 10\n              } : {\n                alignSelf: \"flex-start\",\n                backgroundColor: \"white\",\n                padding: 8,\n                margin: 10,\n                borderRadius: 7,\n                maxWidth: \"60%\"\n              }],\n              children: _jsxDEV(View, {\n                children: [_jsxDEV(View, {\n                  style: {\n                    flexDirection: \"row\",\n                    alignItems: \"center\"\n                  },\n                  children: [_jsxDEV(AntDesign, {\n                    name: \"pdffile1\",\n                    size: 24,\n                    color: \"#d02\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 589,\n                    columnNumber: 23\n                  }, _this), _jsxDEV(Text, {\n                    children: item.fileName\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 590,\n                    columnNumber: 23\n                  }, _this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 586,\n                  columnNumber: 21\n                }, _this), _jsxDEV(Text, {\n                  style: {\n                    textAlign: \"right\",\n                    fontSize: 9,\n                    position: \"absolute\",\n                    right: 10,\n                    bottom: 7,\n                    color: \"white\",\n                    marginTop: 5\n                  },\n                  children: formatTime(item == null ? void 0 : item.timeStamp)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 593,\n                  columnNumber: 21\n                }, _this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 585,\n                columnNumber: 19\n              }, _this)\n            }, index, false, {\n              fileName: _jsxFileName,\n              lineNumber: 559,\n              columnNumber: 17\n            }, _this);\n          }\n        }\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 436,\n      columnNumber: 7\n    }, _this), _jsxDEV(View, {\n      style: {\n        flexDirection: \"row\",\n        alignItems: \"center\",\n        paddingHorizontal: 10,\n        paddingVertical: 10,\n        borderTopWidth: 1,\n        borderTopColor: \"#dddddd\",\n        marginBottom: showEmojiSelector ? 0 : 25\n      },\n      children: [_jsxDEV(Entypo, {\n        onPress: handleEmojiPress,\n        style: {\n          marginRight: 5\n        },\n        name: \"emoji-happy\",\n        size: 24,\n        color: \"gray\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 625,\n        columnNumber: 9\n      }, _this), _jsxDEV(Entypo, {\n        name: \"attachment\",\n        size: 24,\n        color: \"black\",\n        onPress: pickDocument\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 633,\n        columnNumber: 9\n      }, _this), _jsxDEV(TextInput, {\n        value: message,\n        onChangeText: function onChangeText(text) {\n          return setMessage(text);\n        },\n        style: {\n          flex: 1,\n          height: 40,\n          borderWidth: 1,\n          borderColor: \"#dddddd\",\n          borderRadius: 20,\n          paddingHorizontal: 10\n        },\n        placeholder: \"Type Your message...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 639,\n        columnNumber: 9\n      }, _this), _jsxDEV(View, {\n        style: {\n          flexDirection: \"row\",\n          alignItems: \"center\",\n          gap: 7,\n          marginHorizontal: 8\n        },\n        children: [_jsxDEV(Entypo, {\n          onPress: pickImage,\n          name: \"camera\",\n          size: 24,\n          color: \"gray\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 661,\n          columnNumber: 11\n        }, _this), _jsxDEV(Feather, {\n          name: \"mic\",\n          size: 24,\n          color: \"gray\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 663,\n          columnNumber: 11\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 653,\n        columnNumber: 9\n      }, _this), _jsxDEV(Pressable, {\n        onPress: function onPress() {\n          return handleSend(\"text\");\n        },\n        style: {\n          backgroundColor: \"#007bff\",\n          paddingVertical: 8,\n          paddingHorizontal: 12,\n          borderRadius: 20\n        },\n        children: _jsxDEV(Text, {\n          style: {\n            color: \"white\",\n            fontWeight: \"bold\"\n          },\n          children: \"Send\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 675,\n          columnNumber: 11\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 666,\n        columnNumber: 9\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 614,\n      columnNumber: 7\n    }, _this), showEmojiSelector && _jsxDEV(EmojiSelector, {\n      onEmojiSelected: function onEmojiSelected(emoji) {\n        setMessage(function (prevMessage) {\n          return prevMessage + emoji;\n        });\n      },\n      style: {\n        height: 500\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 680,\n      columnNumber: 9\n    }, _this), _jsxDEV(Modal, {\n      animationType: \"slide\",\n      transparent: true,\n      visible: modalVisible,\n      onRequestClose: function onRequestClose() {\n        setModalVisible(!modalVisible);\n      },\n      children: _jsxDEV(View, {\n        style: styles.centeredView,\n        children: _jsxDEV(View, {\n          style: styles.modalView,\n          children: [_jsxDEV(Text, {\n            style: styles.modalText,\n            children: \"Share Message\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 698,\n            columnNumber: 13\n          }, _this), _jsxDEV(ScrollView, {\n            children: acceptedFriends.map(function (item, index) {\n              return _jsxDEV(TouchableOpacity, {\n                onPress: function onPress() {\n                  return handleShareMessageFriend(item, index);\n                },\n                children: _jsxDEV(View, {\n                  style: {\n                    flexDirection: \"row\",\n                    alignItems: \"center\",\n                    gap: 10,\n                    marginBottom: 10\n                  },\n                  children: [_jsxDEV(Image, {\n                    style: {\n                      width: 30,\n                      height: 30,\n                      borderRadius: 15,\n                      resizeMode: \"cover\"\n                    },\n                    source: {\n                      uri: item.image\n                    }\n                  }, index, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 714,\n                    columnNumber: 21\n                  }, _this), _jsxDEV(Text, {\n                    style: {\n                      fontSize: 20,\n                      fontWeight: 500\n                    },\n                    children: item.name\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 724,\n                    columnNumber: 21\n                  }, _this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 706,\n                  columnNumber: 19\n                }, _this)\n              }, index, false, {\n                fileName: _jsxFileName,\n                lineNumber: 702,\n                columnNumber: 17\n              }, _this);\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 700,\n            columnNumber: 13\n          }, _this), _jsxDEV(TouchableOpacity, {\n            children: _jsxDEV(Pressable, {\n              style: [styles.button, styles.buttonClose],\n              onPress: function onPress() {\n                return setModalVisible(!modalVisible);\n              },\n              children: _jsxDEV(Text, {\n                style: styles.textStyle,\n                children: \"Close\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 736,\n                columnNumber: 17\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 732,\n              columnNumber: 15\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 731,\n            columnNumber: 13\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 697,\n          columnNumber: 11\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 696,\n        columnNumber: 9\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 688,\n      columnNumber: 7\n    }, _this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 435,\n    columnNumber: 5\n  }, _this);\n};\nexport default ChatMessagesScreen;\nvar styles = StyleSheet.create({\n  centeredView: {\n    flex: 1,\n    marginTop: 22\n  },\n  modalView: {\n    margin: 20,\n    backgroundColor: \"white\",\n    borderRadius: 20,\n    padding: 35,\n    alignItems: \"center\",\n    shadowColor: \"#000\",\n    shadowOffset: {\n      width: 0,\n      height: 2\n    },\n    shadowOpacity: 0.25,\n    shadowRadius: 4,\n    elevation: 5\n  },\n  button: {\n    borderRadius: 20,\n    padding: 10,\n    elevation: 2\n  },\n  buttonOpen: {\n    backgroundColor: \"#F194FF\"\n  },\n  buttonClose: {\n    backgroundColor: \"#2196F3\"\n  },\n  textStyle: {\n    color: \"white\",\n    fontWeight: \"bold\",\n    textAlign: \"center\"\n  },\n  modalText: {\n    marginBottom: 15,\n    textAlign: \"center\",\n    fontSize: 20,\n    fontWeight: \"bold\"\n  },\n  containerReadPDF: {\n    flex: 1,\n    justifyContent: \"flex-start\",\n    alignItems: \"center\",\n    marginTop: 25\n  },\n  pdf: {\n    flex: 1,\n    width: Dimensions.get(\"window\").width\n  }\n});","map":{"version":3,"names":["React","useState","useContext","useLayoutEffect","useEffect","useRef","Feather","Ionicons","FontAwesome","AntDesign","MaterialIcons","Entypo","EmojiSelector","UserType","useNavigation","useRoute","ImagePicker","Socket","io","FileSystem","PDFReader","DocumentPicker","Octicons","UserChat","WebView","jsxDEV","_jsxDEV","ChatMessagesScreen","_useState","_useState2","_slicedToArray","showEmojiSelector","setShowEmojiSelector","_useState3","_useState4","selectedMessages","setSelectedMessages","_useState5","_useState6","messages","setMessages","_useState7","_useState8","recepientData","setRecepientData","navigation","_useState9","_useState10","selectedImage","setSelectedImage","route","recepientId","params","_useState11","_useState12","message","setMessage","_useContext","userId","setUserId","_useState13","_useState14","acceptedFriends","setAcceptedFriends","_useState15","_useState16","itemIndex","setItemIndex","scrollViewRef","_useState17","_useState18","selectedImageShare","setSelectedImageShare","_useState19","_useState20","modalVisible","setModalVisible","_useState21","_useState22","source","setSource","socketRef","current","on","newMessage","prevMessages","concat","_toConsumableArray","_ref","_ref2","messageIds","filter","includes","_id","disconnect","scrollToBottom","scrollToEnd","animated","handleContentSizeChange","handleEmojiPress","fetchMessages","_ref3","_asyncToGenerator","response","fetch","data","json","ok","console","log","status","error","apply","arguments","handleShareMessage","acceptedFriendsList","_ref4","handleShareMessageFriend","_ref5","item","formData","FormData","append","messageType","uri","name","type","method","body","emit","senderId","_x","fetchRecepientData","_ref6","handleSend","_ref7","imageUri","fileName","_x2","_x3","_x4","image","baseUrl","imageUrl","setOptions","headerTitle","headerLeft","View","style","flexDirection","alignItems","gap","children","onPress","goBack","size","color","_jsxFileName","lineNumber","columnNumber","_this","length","Text","fontSize","fontWeight","Image","width","height","borderRadius","resizeMode","marginLeft","headerRight","Pressable","styles","button","buttonOpen","deleteMessages","_ref8","headers","JSON","stringify","prevSelectedMessages","id","_x5","formatTime","time","options","hour","minute","Date","toLocaleString","pickImage","_ref9","result","launchImageLibraryAsync","mediaTypes","MediaTypeOptions","All","allowsEditing","aspect","quality","canceled","assets","handleSelectMessage","index","isSelected","previousMessages","pickDocument","_ref10","getDocumentAsync","handleReadDocument","_ref11","_x6","_x7","_x8","KeyboardAvoidingView","flex","backgroundColor","ScrollView","ref","contentContainerStyle","flexGrow","onContentSizeChange","map","_item$senderId","onLongPress","alignSelf","padding","maxWidth","margin","textAlign","marginTop","timeStamp","_item$senderId2","filename","split","pop","TouchableOpacity","position","right","bottom","documentUrl","_item$senderId3","paddingHorizontal","paddingVertical","borderTopWidth","borderTopColor","marginBottom","marginRight","TextInput","value","onChangeText","text","borderWidth","borderColor","placeholder","marginHorizontal","onEmojiSelected","emoji","prevMessage","Modal","animationType","transparent","visible","onRequestClose","centeredView","modalView","modalText","buttonClose","textStyle","StyleSheet","create","shadowColor","shadowOffset","shadowOpacity","shadowRadius","elevation","containerReadPDF","justifyContent","pdf","Dimensions","get"],"sources":["D:/20045291/CNM/BTL/realtime-chat-app-main/FrontEnd/screens/ChatMessagesScreen.js"],"sourcesContent":["import {\n  StyleSheet,\n  Text,\n  View,\n  ScrollView,\n  KeyboardAvoidingView,\n  TextInput,\n  Pressable,\n  Image,\n  Alert,\n  Modal,\n  TouchableOpacity,\n  Dimensions,\n  Linking,\n} from \"react-native\";\nimport React, {\n  useState,\n  useContext,\n  useLayoutEffect,\n  useEffect,\n  useRef,\n} from \"react\";\nimport { Feather } from \"@expo/vector-icons\";\nimport { Ionicons } from \"@expo/vector-icons\";\nimport { FontAwesome, AntDesign } from \"@expo/vector-icons\";\nimport { MaterialIcons } from \"@expo/vector-icons\";\nimport { Entypo } from \"@expo/vector-icons\";\nimport EmojiSelector from \"react-native-emoji-selector\";\nimport { UserType } from \"../UserContext\";\nimport { useNavigation, useRoute } from \"@react-navigation/native\";\nimport * as ImagePicker from \"expo-image-picker\";\nimport { Socket, io } from \"socket.io-client\";\nimport * as FileSystem from 'expo-file-system';\n\nimport { PDFReader } from 'rn-pdf-reader-js';\n\n\nimport * as DocumentPicker from \"expo-document-picker\";\n\nimport { Octicons } from \"@expo/vector-icons\";\nimport UserChat from \"../components/UserChat\";\nimport WebView from \"react-native-webview\";\n\nconst ChatMessagesScreen = () => {\n  const [showEmojiSelector, setShowEmojiSelector] = useState(false);\n  const [selectedMessages, setSelectedMessages] = useState([]);\n  const [messages, setMessages] = useState([]);\n  const [recepientData, setRecepientData] = useState();\n  const navigation = useNavigation();\n  const [selectedImage, setSelectedImage] = useState(\"\");\n  const route = useRoute();\n  const { recepientId } = route.params;\n  const [message, setMessage] = useState(\"\");\n  const { userId, setUserId } = useContext(UserType);\n  const [acceptedFriends, setAcceptedFriends] = useState([]);\n  const [itemIndex, setItemIndex] = useState(null);\n  const scrollViewRef = useRef(null);\n  const [selectedImageShare, setSelectedImageShare] = useState();\n  const [modalVisible, setModalVisible] = useState(false);\n  const [source, setSource] = useState(null);\n\n  const socketRef = useRef(null);\n\n  useEffect(() => {\n    // Kết nối với máy chủ Socket.io khi component được tạo\n    socketRef.current = io(\"localhost:8000\");\n\n    // Lắng nghe sự kiện \"newMessage\" từ máy chủ và cập nhật danh sách tin nhắn\n    socketRef.current.on(\"newMessage\", (newMessage) => {\n      setMessages((prevMessages) => [...prevMessages, newMessage]);\n    });\n\n    // Lắng nghe sự kiện \"sendMessage\" từ máy chủ và cập nhật danh sách tin nhắn\n    socketRef.current.on(\"sendMessage\", ({ newMessage }) => {\n      setMessages((prevMessages) => [...prevMessages, newMessage]);\n    });\n    socketRef.current.on(\"deleteMessages\", ({ messageIds }) => {\n      // Remove the deleted messages from the messages state\n      setMessages((prevMessages) =>\n        prevMessages.filter((message) => !messageIds.includes(message._id))\n      );\n    });\n\n    // Đảm bảo rằng bạn ngắt kết nối khi component unmount\n    return () => {\n      socketRef.current.disconnect();\n    };\n  }, []);\n\n  useEffect(() => {\n    scrollToBottom();\n  }, []);\n\n  const scrollToBottom = () => {\n    if (scrollViewRef.current) {\n      scrollViewRef.current.scrollToEnd({ animated: false });\n    }\n  };\n\n  const handleContentSizeChange = () => {\n    scrollToBottom();\n  };\n\n  const handleEmojiPress = () => {\n    setShowEmojiSelector(!showEmojiSelector);\n  };\n\n  const fetchMessages = async () => {\n    try {\n      const response = await fetch(\n        `localhost:8000/messages/${userId}/${recepientId}`\n      );\n      const data = await response.json();\n\n      if (response.ok) {\n        setMessages(data);\n      } else {\n        console.log(\"error showing messags\", response.status.message);\n      }\n    } catch (error) {\n      console.log(\"error fetching messages\", error);\n    }\n  };\n\n  const handleShareMessage = () => {\n    setModalVisible(true);\n  };\n\n  useEffect(() => {\n    fetchMessages();\n  }, []);\n\n  useEffect(() => {\n    const acceptedFriendsList = async () => {\n      try {\n        const response = await fetch(\n          `localhost:8000/accepted-friends/${userId}`\n        );\n        const data = await response.json();\n\n        if (response.ok) {\n          setAcceptedFriends(data);\n        }\n      } catch (error) {\n        console.log(\"error showing the accepted friends\", error);\n      }\n    };\n\n    acceptedFriendsList();\n  }, []);\n\n  const handleShareMessageFriend = async (item) => {\n    // lay id cua nguoi nhan\n    const recepientId = item._id;\n\n    try {\n      const formData = new FormData();\n      formData.append(\"senderId\", userId);\n      formData.append(\"recepientId\", recepientId);\n      console.log(\"messageType:\", messages[itemIndex].messageType);\n      console.log(\"messageText:\", messages[itemIndex].message);\n      // console.log(\"uri:\", selectedImageShare.uri);\n\n      //if the message type id image or a normal text\n      if (messages[itemIndex].messageType === \"image\") {\n        formData.append(\"messageType\", \"image\");\n        formData.append(\"imageFile\", {\n          uri: selectedImageShare.uri,\n\n          name: \"image.jpg\",\n          type: \"image/jpeg\",\n        });\n      } else {\n        formData.append(\"messageType\", \"text\");\n        formData.append(\"messageText\", messages[itemIndex].message);\n      }\n\n      const response = await fetch(\"localhost:8000/messages\", {\n        method: \"POST\",\n        body: formData,\n      });\n\n      if (response.ok) {\n        setMessage(\"\");\n        setSelectedImage(\"\");\n        // Thông báo cho máy chủ và bên B về sự kiện mới\n        socketRef.current.emit(\"sendMessage\", {\n          senderId: userId,\n          recepientId: recepientId,\n          newMessage: response.newMessage, // Modify this line based on your server response\n        });\n        console.log(\"newMessage:\", response.newMessage);\n        console.log(\"senderId:\", userId);\n        console.log(\"recepientId:\", recepientId);\n        // Fetch lại danh sách tin nhắn để cập nhật giao diện\n        fetchMessages();\n      }\n      // đóng modal\n      setModalVisible(!modalVisible);\n    } catch (error) {\n      console.log(\"error sending message\", error);\n    }\n  };\n\n  useEffect(() => {\n    const fetchRecepientData = async () => {\n      try {\n        const response = await fetch(\n          `localhost:8000/user/${recepientId}`\n        );\n        const data = await response.json();\n        setRecepientData(data);\n      } catch (error) {\n        console.log(\"error retrieving details\", error);\n      }\n    };\n  \n    fetchRecepientData();\n  \n    \n  }, [recepientData]);\n  \n\n  const handleSend = async (messageType, imageUri, fileName) => {\n    try {\n      const formData = new FormData();\n      formData.append(\"senderId\", userId);\n      formData.append(\"recepientId\", recepientId);\n      // console.log(\"filename:\", fileName);\n      //if the message type id image or a normal text\n      if (messageType === \"image\") {\n        formData.append(\"messageType\", \"image\");\n        formData.append(\"file\", {\n          uri: imageUri,\n          name: \"image.jpg\",\n          type: \"image/jpeg\",\n        });\n      } else if (messageType === \"document\") {\n        formData.append(\"messageType\", \"document\");\n        formData.append(\"fileName\", fileName);\n        formData.append(\"file\", {\n          uri: imageUri,\n          name: \"document.pdf\",\n          type: \"application/pdf\",\n        });\n      } else {\n        formData.append(\"messageType\", \"text\");\n        formData.append(\"messageText\", message);\n      }\n\n      const response = await fetch(\"localhost:8000/messages\", {\n        method: \"POST\",\n        body: formData,\n      });\n\n      if (response.ok) {\n        setMessage(\"\");\n        setSelectedImage(\"\");\n        // Thông báo cho máy chủ và bên B về sự kiện mới\n        socketRef.current.emit(\"sendMessage\", {\n          senderId: userId,\n          recepientId,\n          newMessage: response.newMessage, // Modify this line based on your server response\n        });\n\n        // Fetch lại danh sách tin nhắn để cập nhật giao diện\n        fetchMessages();\n      }\n    } catch (error) {\n      console.log(\"error in sending the message\", error);\n    }\n  };\n\n\nuseEffect(()=>{\n  if (recepientData && recepientData.image) {\n    const baseUrl = \"/Users/nganle/Downloads/realtime-chat-app/BackEnd/\";\n    const imageUrl = recepientData.image;\n    const source = { uri: baseUrl + imageUrl };\n    setSource(source);\n    console.log(\"source :\",source);\n  }\n},[recepientData])\n  \n\n  useLayoutEffect(() => {\n    navigation.setOptions({\n      headerTitle: \"\",\n      headerLeft: () => (\n        <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 10 }}>\n          <Ionicons\n            onPress={() => navigation.goBack()}\n            name=\"arrow-back\"\n            size={24}\n            color=\"black\"\n          />\n\n          {selectedMessages.length > 0 ? (\n            <View>\n              <Text style={{ fontSize: 16, fontWeight: \"500\" }}>\n                {selectedMessages.length}\n              </Text>\n            </View>\n          ) : (\n            <View style={{ flexDirection: \"row\", alignItems: \"center\" }}>\n              <Image\n                style={{\n                  width: 30,\n                  height: 30,\n                  borderRadius: 15,\n                  resizeMode: \"cover\",\n                }}\n                source={source}\n              />\n\n              <Text style={{ marginLeft: 5, fontSize: 15, fontWeight: \"bold\" }}>\n                {recepientData?.name}\n              </Text>\n            </View>\n          )}\n        </View>\n      ),\n      headerRight: () =>\n        selectedMessages.length > 0 ? (\n          <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 10 }}>\n            {/* <ModalComponent/> */}\n\n            {/* // chia sẽ tin nhắn  */}\n            <Pressable\n              style={[styles.button, styles.buttonOpen]}\n              onPress={handleShareMessage}\n            >\n              <Ionicons name=\"arrow-undo\" size={24} color=\"black\" />\n            </Pressable>\n\n            <FontAwesome name=\"star\" size={24} color=\"black\" />\n            <MaterialIcons\n              onPress={() => deleteMessages(selectedMessages)}\n              name=\"delete\"\n              size={24}\n              color=\"black\"\n            />\n          </View>\n        ) : null,\n    });\n  }, [recepientData, selectedMessages]);\n\n  const deleteMessages = async (messageIds) => {\n    try {\n      const response = await fetch(\"localhost:8000/deleteMessages\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ messages: messageIds }),\n      });\n\n      if (response.ok) {\n        setSelectedMessages((prevSelectedMessages) =>\n          prevSelectedMessages.filter((id) => !messageIds.includes(id))\n        );\n        socketRef.current.emit(\"deleteMessages\", { messageIds });\n\n        fetchMessages();\n      } else {\n        console.log(\"error deleting messages\", response.status);\n      }\n      //socketio\n    } catch (error) {\n      console.log(\"error deleting messages\", error);\n    }\n  };\n\n  const formatTime = (time) => {\n    const options = { hour: \"numeric\", minute: \"numeric\" };\n    return new Date(time).toLocaleString(\"en-US\", options);\n  };\n\n  const pickImage = async () => {\n    let result = await ImagePicker.launchImageLibraryAsync({\n      mediaTypes: ImagePicker.MediaTypeOptions.All,\n      allowsEditing: true,\n      aspect: [4, 3],\n      quality: 1,\n    });\n    delete result.canceled;\n    console.log(result.assets[0].uri);\n    if (!result.canceled) {\n      handleSend(\"image\", result.assets[0].uri);\n    }\n  };\n  const handleSelectMessage = (message, index, source) => {\n    //check if the message is already selected\n    const isSelected = selectedMessages.includes(message._id);\n    setItemIndex(index);\n    setSelectedImageShare(source);\n\n    if (isSelected) {\n      setSelectedMessages((previousMessages) =>\n        previousMessages.filter((id) => id !== message._id)\n      );\n    } else {\n      setSelectedMessages((previousMessages) => [\n        ...previousMessages,\n        message._id,\n      ]);\n    }\n  };\n\n  const pickDocument = async () => {\n    try {\n      const result = await DocumentPicker.getDocumentAsync();\n\n      // Check if the user canceled the picker\n      if (result.canceled) {\n        return;\n      }\n\n      // You can now use result.uri to upload the document file to your server\n      // console.log(\"Document URI:\", result.assets[0].uri);\n\n      // Handle the document file upload\n      handleSend(\"document\", result.assets[0].uri, result.assets[0].name);\n    } catch (error) {\n      console.log(\"Error picking document:\", error);\n    }\n  };\n\n  const handleReadDocument = async (item, index, source) => {\n    const uri = source;\n    \n  };\n\n  return (\n    <KeyboardAvoidingView style={{ flex: 1, backgroundColor: \"#F0F0F0\" }}>\n      <ScrollView\n        ref={scrollViewRef}\n        contentContainerStyle={{ flexGrow: 1 }}\n        onContentSizeChange={handleContentSizeChange}\n      >\n        {messages.map((item, index) => {\n          if (item.messageType === \"text\") {\n            const isSelected = selectedMessages.includes(item._id);\n            return (\n              <Pressable\n                onLongPress={() => handleSelectMessage(item, index)}\n                key={index}\n                style={[\n                  item?.senderId?._id === userId\n                    ? {\n                        alignSelf: \"flex-end\",\n                        backgroundColor: \"#DCF8C6\",\n                        padding: 8,\n                        maxWidth: \"60%\",\n                        borderRadius: 7,\n                        margin: 10,\n                      }\n                    : {\n                        alignSelf: \"flex-start\",\n                        backgroundColor: \"white\",\n                        padding: 8,\n                        margin: 10,\n                        borderRadius: 7,\n                        maxWidth: \"60%\",\n                      },\n\n                  isSelected && { width: \"100%\", backgroundColor: \"#F0FFFF\" },\n                ]}\n              >\n                <Text\n                  style={{\n                    fontSize: 13,\n                    textAlign: isSelected ? \"right\" : \"left\",\n                  }}\n                >\n                  {item?.message}\n                </Text>\n                <Text\n                  style={{\n                    textAlign: \"right\",\n                    fontSize: 9,\n                    color: \"gray\",\n                    marginTop: 5,\n                  }}\n                >\n                  {formatTime(item.timeStamp)}\n                </Text>\n              </Pressable>\n            );\n          }\n\n          if (item.messageType === \"image\") {\n            if (item.imageUrl) {\n              const baseUrl =\n                \"/Users/nganle/Downloads/realtime-chat-app/BackEnd/files/\";\n\n              const imageUrl = item.imageUrl;\n              const filename = imageUrl.split(\"/\").pop();\n              const source = { uri: baseUrl + filename };\n\n              return (\n                <TouchableOpacity\n                  onLongPress={() => handleSelectMessage(item, index, source)}\n                  key={index}\n                  style={[\n                    item?.senderId?._id === userId\n                      ? {\n                          alignSelf: \"flex-end\",\n                          backgroundColor: \"#DCF8C6\",\n                          padding: 8,\n                          maxWidth: \"60%\",\n                          borderRadius: 7,\n                          margin: 10,\n                        }\n                      : {\n                          alignSelf: \"flex-start\",\n                          backgroundColor: \"white\",\n                          padding: 8,\n                          margin: 10,\n                          borderRadius: 7,\n                          maxWidth: \"60%\",\n                        },\n                  ]}\n                >\n                  <View>\n                    <Image\n                      source={source}\n                      style={{ width: 200, height: 200, borderRadius: 7 }}\n                    />\n                    <Text\n                      style={{\n                        textAlign: \"right\",\n                        fontSize: 9,\n                        position: \"absolute\",\n                        right: 10,\n                        bottom: 7,\n                        color: \"white\",\n                        marginTop: 5,\n                      }}\n                    >\n                      {formatTime(item?.timeStamp)}\n                    </Text>\n                  </View>\n                </TouchableOpacity>\n              );\n            }\n          }\n          // hiển thị document\n          if (item.messageType === \"document\") {\n            if (item.documentUrl) {\n              const baseUrl = \"/Users/nganle/Downloads/realtime-chat-app/BackEnd/files/\";\n\n              const documentUrl = item.documentUrl;\n              const filename = documentUrl.split(\"/\").pop();\n              const source = { uri: baseUrl + filename };\n\n              console.log(\"source pdf:\", source);\n              return (\n                <TouchableOpacity\n                  onPress={() => handleReadDocument(item, index, source)}\n                  onLongPress={() => handleSelectMessage(item, index, source)}\n                  key={index}\n                  style={[\n                    item?.senderId?._id === userId\n                      ? {\n                          alignSelf: \"flex-end\",\n                          backgroundColor: \"#DCF8C6\",\n                          padding: 8,\n                          maxWidth: \"60%\",\n                          borderRadius: 7,\n                          margin: 10,\n                        }\n                      : {\n                          alignSelf: \"flex-start\",\n                          backgroundColor: \"white\",\n                          padding: 8,\n                          margin: 10,\n                          borderRadius: 7,\n                          maxWidth: \"60%\",\n                        },\n                  ]}\n                >\n                 \n\n                  <View>\n                    <View\n                      style={{ flexDirection: \"row\", alignItems: \"center\" }}\n                    >\n                      <AntDesign name=\"pdffile1\" size={24} color=\"#d02\" />\n                      <Text>{item.fileName}</Text>\n                    </View>\n\n                    <Text\n                      style={{\n                        textAlign: \"right\",\n                        fontSize: 9,\n                        position: \"absolute\",\n                        right: 10,\n                        bottom: 7,\n                        color: \"white\",\n                        marginTop: 5,\n                      }}\n                    >\n                      {formatTime(item?.timeStamp)}\n                    </Text>\n                  </View>\n                </TouchableOpacity>\n              );\n            }\n          }\n        })}\n      </ScrollView>\n\n      <View\n        style={{\n          flexDirection: \"row\",\n          alignItems: \"center\",\n          paddingHorizontal: 10,\n          paddingVertical: 10,\n          borderTopWidth: 1,\n          borderTopColor: \"#dddddd\",\n          marginBottom: showEmojiSelector ? 0 : 25,\n        }}\n      >\n        <Entypo\n          onPress={handleEmojiPress}\n          style={{ marginRight: 5 }}\n          name=\"emoji-happy\"\n          size={24}\n          color=\"gray\"\n        />\n\n        <Entypo\n          name=\"attachment\"\n          size={24}\n          color=\"black\"\n          onPress={pickDocument}\n        />\n        <TextInput\n          value={message}\n          onChangeText={(text) => setMessage(text)}\n          style={{\n            flex: 1,\n            height: 40,\n            borderWidth: 1,\n            borderColor: \"#dddddd\",\n            borderRadius: 20,\n            paddingHorizontal: 10,\n          }}\n          placeholder=\"Type Your message...\"\n        />\n\n        <View\n          style={{\n            flexDirection: \"row\",\n            alignItems: \"center\",\n            gap: 7,\n            marginHorizontal: 8,\n          }}\n        >\n          <Entypo onPress={pickImage} name=\"camera\" size={24} color=\"gray\" />\n\n          <Feather name=\"mic\" size={24} color=\"gray\" />\n        </View>\n\n        <Pressable\n          onPress={() => handleSend(\"text\")}\n          style={{\n            backgroundColor: \"#007bff\",\n            paddingVertical: 8,\n            paddingHorizontal: 12,\n            borderRadius: 20,\n          }}\n        >\n          <Text style={{ color: \"white\", fontWeight: \"bold\" }}>Send</Text>\n        </Pressable>\n      </View>\n\n      {showEmojiSelector && (\n        <EmojiSelector\n          onEmojiSelected={(emoji) => {\n            setMessage((prevMessage) => prevMessage + emoji);\n          }}\n          style={{ height: 500 }}\n        />\n      )}\n\n      <Modal\n        animationType=\"slide\"\n        transparent={true}\n        visible={modalVisible}\n        onRequestClose={() => {\n          setModalVisible(!modalVisible);\n        }}\n      >\n        <View style={styles.centeredView}>\n          <View style={styles.modalView}>\n            <Text style={styles.modalText}>Share Message</Text>\n\n            <ScrollView>\n              {acceptedFriends.map((item, index) => (\n                <TouchableOpacity\n                  key={index}\n                  onPress={() => handleShareMessageFriend(item, index)}\n                >\n                  <View\n                    style={{\n                      flexDirection: \"row\",\n                      alignItems: \"center\",\n                      gap: 10,\n                      marginBottom: 10,\n                    }}\n                  >\n                    <Image\n                      key={index}\n                      style={{\n                        width: 30,\n                        height: 30,\n                        borderRadius: 15,\n                        resizeMode: \"cover\",\n                      }}\n                      source={{ uri: item.image }}\n                    />\n                    <Text style={{ fontSize: 20, fontWeight: 500 }}>\n                      {item.name}\n                    </Text>\n                  </View>\n                </TouchableOpacity>\n              ))}\n            </ScrollView>\n            <TouchableOpacity>\n              <Pressable\n                style={[styles.button, styles.buttonClose]}\n                onPress={() => setModalVisible(!modalVisible)}\n              >\n                <Text style={styles.textStyle}>Close</Text>\n              </Pressable>\n            </TouchableOpacity>\n          </View>\n        </View>\n      </Modal>\n    </KeyboardAvoidingView>\n  );\n};\n\nexport default ChatMessagesScreen;\n\nconst styles = StyleSheet.create({\n  centeredView: {\n    flex: 1,\n    // justifyContent: \"center\",\n    // alignItems: \"center\",\n    marginTop: 22,\n  },\n  modalView: {\n    margin: 20,\n    backgroundColor: \"white\",\n    borderRadius: 20,\n    padding: 35,\n    alignItems: \"center\",\n    shadowColor: \"#000\",\n    shadowOffset: {\n      width: 0,\n      height: 2,\n    },\n    shadowOpacity: 0.25,\n    shadowRadius: 4,\n    elevation: 5,\n  },\n  button: {\n    borderRadius: 20,\n    padding: 10,\n    elevation: 2,\n  },\n  buttonOpen: {\n    backgroundColor: \"#F194FF\",\n  },\n  buttonClose: {\n    backgroundColor: \"#2196F3\",\n  },\n  textStyle: {\n    color: \"white\",\n    fontWeight: \"bold\",\n    textAlign: \"center\",\n  },\n  modalText: {\n    marginBottom: 15,\n    textAlign: \"center\",\n    fontSize: 20,\n    fontWeight: \"bold\",\n  },\n  containerReadPDF: {\n    flex: 1,\n    justifyContent: \"flex-start\",\n    alignItems: \"center\",\n    marginTop: 25,\n  },\n  pdf: {\n    flex: 1,\n    width: Dimensions.get(\"window\").width,\n  },\n});\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}